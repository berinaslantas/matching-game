<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EÅŸleÅŸtirme Oyunu</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    padding: 20px;
    text-align: center;
}
select, button {
    margin: 6px;
    padding: 6px 12px;
    background: #161b22;
    color: #c9d1d9;
    border: 1px solid #30363d;
    border-radius: 6px;
}
.game {
    display: flex;
    gap: 12px;
    margin-top: 12px;
}
.column { width: 50%; }
.card {
    background: #161b22;
    padding: 14px;
    margin: 8px 0;
    border-radius: 10px;
    border: 1px solid #30363d;
    cursor: pointer;
    transition: 0.15s;
    color: #c9d1d9;
}
.card.selected { border-color: #58a6ff; }
.card.correct { color:#2ea043; }
.card.wrong { color:#ff7f0e; }
</style>
</head>
<body>

<h2>ðŸ”— EÅŸleÅŸtirme Oyunu</h2>

<select id="mainUnit"></select>
<select id="subUnit"></select>
<button onclick="startGame()">BaÅŸlat</button>
<button onclick="startGeneralWrongs()">Genel YanlÄ±ÅŸlar</button>

<div class="game">
    <div class="column" id="leftCol"></div>
    <div class="column" id="rightCol"></div>
</div>

<script>
const PAGE_SIZE = 5;
let pool = [];
let active = [];
let rightSlots = [];
let selLeft = null;
let selRight = null;
let streak = 0;

function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

/* ===== SES ===== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playCorrect(){
    streak++;
    const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.type="triangle";
    o.frequency.value=Math.min(2000,800*(1+streak*0.2));
    g.gain.setValueAtTime(0.3,audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.4);
    o.connect(g).connect(audioCtx.destination);
    o.start();o.stop(audioCtx.currentTime+0.4);
}
function playWrong(){
    streak=0;
    const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.frequency.value=180;
    g.gain.setValueAtTime(0.2,audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.5);
    o.connect(g).connect(audioCtx.destination);
    o.start();o.stop(audioCtx.currentTime+0.5);
}

/* ===== SELECT ===== */
function fillSelectors(){
    mainUnit.innerHTML="";
    Object.keys(units).forEach(k=>mainUnit.innerHTML+=`<option>${k}</option>`);
    loadSub();
}
function loadSub(){
    subUnit.innerHTML="";
    Object.keys(units[mainUnit.value]).forEach(k=>subUnit.innerHTML+=`<option>${k}</option>`);
}
mainUnit.onchange=loadSub;

/* ===== SAÄž SLOT MANTIÄžI ===== */
function fillRightSlots(){
    const rights=shuffle(active.map(p=>p.right));
    for(let i=0;i<PAGE_SIZE;i++){
        if(!rightSlots[i] && rights.length) rightSlots[i]=rights.shift();
    }
    for(let i=0;i<active.length;i++){
        if(rightSlots[i]===active[i].right){
            const j=(i+1)%PAGE_SIZE;
            [rightSlots[i],rightSlots[j]]=[rightSlots[j],rightSlots[i]];
        }
    }
}

/* ===== OYUN ===== */
function startGame(){
    streak=0;
    pool=shuffle([...units[mainUnit.value][subUnit.value]]);
    active=pool.splice(0,PAGE_SIZE);
    rightSlots=[];
    fillRightSlots();
    render();
}
function startGeneralWrongs(){
    streak=0;
    pool=shuffle(Object.values(generalWrongs).map(o=>o.pair));
    active=pool.splice(0,PAGE_SIZE);
    rightSlots=[];
    fillRightSlots();
    render();
}

function render(){
    leftCol.innerHTML="";
    rightCol.innerHTML="";
    active.forEach(p=>{
        const d=document.createElement("div");
        d.className="card";
        d.innerText=p.left;
        d.onclick=()=>{selLeft=p;select(d)};
        leftCol.appendChild(d);
    });
    rightSlots.forEach(r=>{
        const d=document.createElement("div");
        d.className="card";
        d.innerText=r;
        d.onclick=()=>{selRight=active.find(p=>p.right===r);select(d)};
        rightCol.appendChild(d);
    });
}

function select(el){
    document.querySelectorAll(".card").forEach(c=>c.classList.remove("selected"));
    el.classList.add("selected");
    if(selLeft&&selRight)check();
}

function check(){
    const l=[...leftCol.children].find(c=>c.innerText===selLeft.left);
    const r=[...rightCol.children].find(c=>c.innerText===selRight.right);
    const correct=active.some(p=>p.left===selLeft.left&&p.right===selRight.right);
    if(correct){
        l.style.color=r.style.color="#2ea043";
        playCorrect();
        setTimeout(()=>{
            const aIdx=active.findIndex(p=>p.left===selLeft.left&&p.right===selRight.right);
            if(aIdx>-1)active.splice(aIdx,1);
            const rIdx=[...rightCol.children].indexOf(r);
            rightSlots[rIdx]=null;
            while(active.length<PAGE_SIZE&&pool.length)active.push(pool.shift());
            fillRightSlots();
            selLeft=selRight=null;
            render();
        },150);
    }else{
        l.style.color=r.style.color="#ff7f0e";
        playWrong();
        setTimeout(()=>{
            l.style.color=r.style.color="#c9d1d9";
            selLeft=selRight=null;
        },300);
    }
}

fillSelectors();
</script>
</body>
</html>
