<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>E≈üle≈ütirme Oyunu</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    margin: 0;
    padding: 20px;
    text-align: center;
}
h1 { margin-bottom: 12px; }
select, button {
    margin: 8px;
    padding: 6px 12px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #30363d;
    background: #161b22;
    color: #c9d1d9;
}
.game {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    margin-top: 12px;
}
.column { width: 48%; }
.card {
    background: #161b22;
    padding: 15px;
    margin: 8px 0;
    border-radius: 12px;
    border: 1px solid #30363d;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.15s ease;
}
.card.selected { border-color: #58a6ff; }
.card.correct { color: #238636; border-color: #238636; }
.card.wrong { color: #b45309; border-color: #b45309; }
#score { margin-top: 16px; font-size: 20px; }
</style>
</head>
<body>
<h1>üîó E≈üle≈ütirme Oyunu</h1>

<div>
    <select id="mainUnitSelect">
        <option value="ƒ∞slamiyet √ñncesi T√ºrk Tarihi">Tarih</option>
        <option value="Matematik">Matematik</option>
    </select>
    <select id="subUnitSelect"></select>
    <button id="startBtn">Ba≈ülat</button>
</div>

<div class="game">
    <div class="column" id="left"></div>
    <div class="column" id="right"></div>
</div>

<div id="score">Skor: 0</div>

<script>
let streak = 0;
let score = 0;
let selectedLeft = null;
let selectedRight = null;
let pairs = [];
let currentPagePairs = [];
const PAGE_SIZE = 5;

const STORAGE_KEY = "matching_game_progress_v1";
const generalWrongs = new Map();
const statsIndex = {};

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playDing() {
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.35);
    gain.connect(audioCtx.destination);

    const osc = audioCtx.createOscillator();
    osc.type = "triangle";
    osc.frequency.setValueAtTime(700 + streak*20, audioCtx.currentTime);
    osc.connect(gain);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.35);
}

function playDong() {
    const freqs = [440, 220, 110];
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.15, audioCtx.currentTime + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.6);
    gain.connect(audioCtx.destination);

    freqs.forEach(f => {
        const osc = audioCtx.createOscillator();
        osc.type = "sine";
        osc.frequency.setValueAtTime(f, audioCtx.currentTime);
        osc.connect(gain);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.6);
    });
}

/* ===== VERƒ∞LER ===== */
const units = {
    "ƒ∞slamiyet √ñncesi T√ºrk Tarihi": {
        "T√ºrk adƒ±nƒ±n anlamlarƒ±": [
            { left: "Wambery", right: "T√ºremek" },
            { left: "Doerfer", right: "Devlete baƒülƒ± halk" },
            { left: "Ka≈ügarlƒ± Mahmut", right: "Olgunluk √áaƒüƒ±" },
            { left: "ƒ∞ran Kaynaklarƒ±", right: "G√ºzel ƒ∞nsan" },
            { left: "√áin Kaynaklarƒ±", right: "Miƒüfer" },
            { left: "Ziya G√∂kalp", right: "Kanun ve nizam sahibi" },
            { left: "Diƒüer", right: "G√º√ßl√º, kuvvetli, terk edilmi≈ü" }
        ],
        "Orta Asya K√ºlt√ºr Merkezleri": [
            { left: "Anav", right: "en eski (At ilk kez)" },
            { left: "Afanesyova", right: "en eski T√ºrk (Minusinsk)" },
            { left: "Tagar", right: "en geli≈ümi≈ü (Altaylƒ±lar)" },
            { left: "Andronova", right: "T√ºrk atalarƒ±nƒ±n ya≈üadƒ±ƒüƒ±" },
            { left: "Karasuk", right: "ilk demir i≈ülendiƒüi yer" },
            { left: "Kelteminar", right: "yerle≈üik ya≈üam" }
        ],
        "Boylar": [
            { left: "Anav", right: "en eski (At ilk kez)" },
            { left: "Afanesyova", right: "en eski T√ºrk (Minusinsk)" },
            { left: "Tagar", right: "en geli≈ümi≈ü (Altaylƒ±lar)" },
            { left: "Andronova", right: "T√ºrk atalarƒ±nƒ±n ya≈üadƒ±ƒüƒ±" },
            { left: "Karasuk", right: "ilk demir i≈ülendiƒüi yer" },
            { left: "Kelteminar", right: "yerle≈üik ya≈üam" }
        ],
        "Orta Asya T√ºrkleri": [
            { left: "Sakalar", right: "Bilinen ilk T√ºrk boyu" },
            { left: "Sakalar", right: "Alp Er Tunga" },
            { left: "Sakalar", right: "lk T√ºrk kadƒ±n h√ºk√ºmdar Tomris Hatun" },
            { left: "Sakalar", right: "Amazon (kadƒ±n sava≈ü√ßƒ±lar)" },
            { left: "Sakalar", right: "Balbal (mezar ta≈üƒ±) dikme geleneƒüi" },
            { left: "Sakalar", right: "Atƒ± evcille≈ütirmi≈ü d√ºnyada ilk √ºzengi" },
            { left: "Sakalar", right: "G√ºn√ºm√ºzde Rusya Federasyonunda Yakut T√ºrkleri" },
            { left: "Sakalar", right: "Bozkƒ±rƒ±n kuyumcularƒ±" },
            { left: "Asya Hun Devleti (B√ºy√ºk Hun)", right: "Kurucusu Teoman" },
            { left: "Asya Hun Devleti (B√ºy√ºk Hun)", right: "Ba≈ükenti √ñt√ºken. Kutsal b√∂lge veya Toprak Ana" },
            { left: "Asya Hun Devleti (B√ºy√ºk Hun)", right: "Mete Vatan Sevgisi(Tunguzlara toprak vermeyip) ilk T√ºrk h√ºk√ºmdar" },
            { left: "Asya Hun Devleti (B√ºy√ºk Hun)", right: "Mete orduda onlu sistem" },
            { left: "Asya Hun Devleti (B√ºy√ºk Hun)", right: "T√ºrk tarihinin ilk yazƒ±lƒ± antla≈ümasƒ± √áinlilerle yapƒ±lan Kuzey ≈ûansi" },
            { left: "Asya Hun Devleti (B√ºy√ºk Hun)", right: "Orta Asyada Mete T√ºrk boylarƒ±nƒ±(26) bir bayrak altƒ±nda toplayan ilk devlet" },
            { left: "Asya Hun Devleti (B√ºy√ºk Hun)", right: "Orta Asyada ilk defa siyasi birlik -Mete Han" },
            { left: "Mukan Kaƒüan", right: "I. G√∂kt√ºrklerde T√ºrk siyasi birliƒüi saƒülayan" },
            { left: "Kapgan Kaƒüan", right: "II. G√∂kt√ºrklerde T√ºrk siyasi birliƒüi saƒülayan" },
            { left: "Batƒ± Hun h√ºk√ºmdarƒ± √ái√ßi ", right: " istiklali feda etmeyi g√ºl√ºn√ß ve utan√ß verici bulmu≈ü " },
            { left: "Batƒ± Hun h√ºk√ºmdarƒ± Balamir", right: "Kavimler g√∂√ß√ºne √∂nderlik etmi≈ü" }
        ],
        "Avrupa T√ºrkleri": [
            { left: "Avrupa Hun Devleti", right: "Kurucusu Balamir -Macaristanda" },
            { left: "Avrupa Hun Devleti en parlak d√∂nem", right: "Attila" },
            { left: "Avrupa Hun Devleti", right: "Avrupa'da kurulan ilk T√ºrk devleti" },
            { left: "Hem Orta Asya hem Avrupada Kurulanlar", right: "B√ºy√ºk Hunlar ve Avarlar" },
            { left: "Avrupa Hun Devleti", right: "Margos Barƒ±≈üƒ± ve Anatolyus Ant." },
            { left: "Avrupa Hun Devleti", right: "Galya ve ƒ∞talya seferleri (Papanƒ±n ricasƒ±)" },
            { left: "Atilla'nƒ±n Roma'yƒ± almaktan vazge√ßme nedenleri:", right: "Papa I. Leon'un ricasƒ±" },
            { left: "Atilla'nƒ±n Roma'yƒ± almaktan vazge√ßme nedenleri:", right: "Roma'nƒ±n Hristiyanlarca kutsal olmasƒ±" },
            { left: "Atilla'nƒ±n Roma'yƒ± almaktan vazge√ßme nedenleri:", right: "Batƒ± Roma'nƒ±n g√ºc√ºn√º kƒ±rdƒ±ƒüƒ±na inanmasƒ±" },
            { left: "Atilla'nƒ±n Roma'yƒ± almaktan vazge√ßme nedenleri:", right: "Doƒüuda Sasani tehlikesinin bulunmasƒ±" },
            { left: "Attilla'nƒ±n √ºnvanlarƒ± ", right: "(Etzel (Nibelungen)(Hun burgant m√ºcadelesi)" },
            { left: "Attilla'nƒ±n √ºnvanlarƒ± ", right: "Cesur Kavimlerin Efendisi" },
            { left: "Attilla'nƒ±n √ºnvanlarƒ± ", right: "Tanrƒ±nƒ±n kam√ßƒ±sƒ±" },
            { left: "Avarlar", right: "Kurucusu Bayan Han" },
            { left: "Avarlar", right: "ƒ∞stanbul'u ku≈üatan ilk T√ºrk devleti (2 kere)" },
            { left: "Avarlar", right: "√úzengi yapƒ±mƒ±nƒ± Avrupalƒ±lara √∂ƒüretmi≈ü" },
            { left: "Avarlar", right: "Juan Juan T√ºrkleri" },
            { left: "Avarlar", right: "Frank saldƒ±rƒ±larƒ±yla yƒ±kƒ±lmƒ±≈ü" }
        ]
    },
    "Matematik": {
        "1. √únite": [
            { left: "2+2", right: "4" },
            { left: "5*3", right: "15" }
        ]
    }
};

/* ===== INDEX ===== */
function buildIndex() {
    Object.values(units).forEach(u =>
        Object.values(u).forEach(list =>
            list.forEach(q => {
                const k = q.left + "||" + q.right;
                if (!statsIndex[k]) {
                    statsIndex[k] = { wrongCount: 0, correctInWrongs: 0 };
                }
            })
        )
    );
}

/* ===== STORAGE ===== */
function saveProgress() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
        statsIndex,
        generalWrongs: [...generalWrongs.keys()]
    }));
}

function loadProgress() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const data = JSON.parse(raw);
    Object.assign(statsIndex, data.statsIndex || {});
    (data.generalWrongs || []).forEach(k => generalWrongs.set(k, true));
}

/* ===== OYUN ===== */
function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

function resetCards() {
    document.querySelectorAll(".card").forEach(c =>
        c.classList.remove("selected","wrong")
    );
}

function render() {
    left.innerHTML = "";
    right.innerHTML = "";
    currentPagePairs.forEach(p => {
        const d = document.createElement("div");
        d.className = "card";
        d.innerText = p.left;
        d.onclick = () => selectLeft(d, p);
        left.appendChild(d);
    });
    currentPagePairs.forEach(p => {
        const d = document.createElement("div");
        d.className = "card";
        d.innerText = p.right;
        d.onclick = () => selectRight(d, p);
        right.appendChild(d);
    });
}

/* ===== SE√áƒ∞M ===== */
function selectLeft(el, p) {
    resetCards();
    el.classList.add("selected");
    selectedLeft = p;
    check();
}

function selectRight(el, p) {
    resetCards();
    el.classList.add("selected");
    selectedRight = p;
    check();
}

function check() {
    if (!selectedLeft || !selectedRight) return;

    // Se√ßilen kartlarƒ±n DOM elementleri
    const leftCard = [...left.children].find(c => c.innerText === selectedLeft.left);
    const rightCard = [...right.children].find(c => c.innerText === selectedRight.right);

    // Aynƒ± sol veya saƒü deƒüeri olan e≈üle≈ümeleri kontrol et
    let correctPairs = currentPagePairs.filter(p => 
        (p.left === selectedLeft.left && p.right === selectedRight.right) || 
        (p.left === selectedLeft.left && Array.isArray(p.right) ? p.right.includes(selectedRight.right) : p.right === selectedRight.right) ||
        (Array.isArray(selectedLeft.right) ? selectedLeft.right.includes(p.right) : selectedLeft.right === p.right) 
    );

    if (correctPairs.length > 0) {
        streak++;
        score++;
        document.getElementById("score").innerText = "Skor: " + score;

        // Doƒüru efekt
        leftCard.classList.add("correct");
        rightCard.classList.add("correct");
        playDing();

        setTimeout(() => {
            // Doƒüru e≈üle≈ümeleri ekrandan kaldƒ±r
            correctPairs.forEach(p => {
                currentPagePairs = currentPagePairs.filter(cp => cp !== p);
                // Havuzdan da √ßƒ±kar
                pairs = pairs.filter(pool => pool !== p);
            });

            // Yeni sorular ekle, sayfa hep 5 e≈üle≈ümede kalsƒ±n
            while(currentPagePairs.length < PAGE_SIZE && pairs.length > 0){
                const np = shuffle([...pairs])[0];
                currentPagePairs.push(np);
                pairs = pairs.filter(p => p !== np);
            }

            render();

            // √únite biti≈ü kontrol√º
            if(currentPagePairs.length === 0 && pairs.length === 0){
                if(confirm("Bu √ºnite bitti. Sonraki √ºniteye ge√ßmek ister misiniz?")) startNextUnit();
            }

        }, 500);

        selectedLeft = selectedRight = null;

    } else {
        // Yanlƒ±≈ü
        leftCard.classList.add("wrong");
        rightCard.classList.add("wrong");
        playDong();
        setTimeout(() => resetCards(), 500);
        selectedLeft = selectedRight = null;
    }
}

// ƒ∞lk sayfa y√ºklemesi
function loadNextPage() {
    currentPagePairs = shuffle([...pairs]).slice(0, PAGE_SIZE);
    // Havuzdan √ßƒ±kar
    currentPagePairs.forEach(p => pairs = pairs.filter(pool => pool !== p));
    render();
}

/* ===== √úNƒ∞TE ===== */
function updateSubUnits() {
    subUnitSelect.innerHTML = "";
    Object.keys(units[mainUnitSelect.value]).forEach(s => {
        const o = document.createElement("option");
        o.value = s;
        o.textContent = s;
        subUnitSelect.appendChild(o);
    });
}

mainUnitSelect.onchange = updateSubUnits;
updateSubUnits();

startBtn.onclick = () => {
    const m = mainUnitSelect.value;
    const s = subUnitSelect.value;
    pairs = shuffle(units[m][s].map(q => q));
    score = 0;
    streak = 0;
    document.getElementById("score").innerText = "Skor: 0";
    loadNextPage();
};

/* ===== BA≈ûLAT ===== */
buildIndex();
loadProgress();
</script>
</body>
</html>







