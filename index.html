<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EÅŸleÅŸtirme Oyunu</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    padding: 20px;
    text-align: center;
}
select, button {
    margin: 6px;
    padding: 6px 12px;
    background: #161b22;
    color: #c9d1d9;
    border: 1px solid #30363d;
    border-radius: 6px;
}
.game {
    display: flex;
    gap: 12px;
    margin-top: 12px;
}
.column { width: 50%; }
.card {
    background: #161b22;
    padding: 14px;
    margin: 8px 0;
    border-radius: 10px;
    border: 1px solid #30363d;
    cursor: pointer;
    transition: 0.15s;
}
.card.selected { border-color: #58a6ff; }
.card.correct { color: #238636; } /* sadece yazÄ± yeÅŸil */
.card.wrong { color: #b45309; }   /* sadece yazÄ± turuncu */
</style>
</head>
<body>

<h2>ðŸ”— EÅŸleÅŸtirme Oyunu</h2>

<select id="mainUnit"></select>
<select id="subUnit"></select>
<button onclick="startGame()">BaÅŸlat</button>
<button onclick="startGeneralWrongs()">Genel YanlÄ±ÅŸlar</button>

<div class="game">
    <div class="column" id="leftCol"></div>
    <div class="column" id="rightCol"></div>
</div>

<script>
/* ===================== VERÄ°LER ===================== */
const units = {
    "Ä°slamiyet Ã–ncesi TÃ¼rk Tarihi": {
        "TÃ¼rk adÄ±nÄ±n anlamlarÄ±": [
            { left: "Wambery", right: ["TÃ¼remek"] },
            { left: "Doerfer", right: ["Devlete baÄŸlÄ± halk"] },
            { left: "KaÅŸgarlÄ± Mahmut", right: ["Olgunluk Ã‡aÄŸÄ±"] },
            { left: "Ä°ran KaynaklarÄ±", right: ["GÃ¼zel Ä°nsan"] },
            { left: "Ã‡in KaynaklarÄ±", right: ["MiÄŸfer"] },
            { left: "Ziya GÃ¶kalp", right: ["Kanun ve nizam sahibi"] },
            { left: "DiÄŸer", right: ["GÃ¼Ã§lÃ¼", "kuvvetli", "terk edilmiÅŸ"] }
        ]
    }
};
const PAGE_SIZE = 5;
let pool = [], active = [], selLeft = null, selRight = null, streak = 0;

/* ===== SESLER ===== */
const audioCtx = new AudioContext();

function playDing() {
    let freq = 700 + streak*20;
    if (freq>2000) freq = 2000;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
    osc.type = "triangle";
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    osc.connect(gain).connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.25);
}

function playDong() {
    const freqs = [200, 150, 100];
    freqs.forEach(f=>{
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
        osc.type="sine";
        osc.frequency.setValueAtTime(f, audioCtx.currentTime);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.3);
    });
}

/* ===== GENEL YANLIÅžLAR ===== */
const STORAGE_KEY = "general_wrongs_v2";
let generalWrongs = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
function saveWrongs(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(generalWrongs)); }
function markWrong(p){ const k=p.left+"||"+p.right; if(!generalWrongs[k]) generalWrongs[k]={pair:p,wrong:0,correct:0}; generalWrongs[k].wrong++; saveWrongs(); }
function markCorrect(p){ const k=p.left+"||"+p.right; if(!generalWrongs[k]) return; generalWrongs[k].correct++; if(generalWrongs[k].correct>=2) delete generalWrongs[k]; saveWrongs(); }

/* ===== OYUN ===== */
function shuffle(a){return a.sort(()=>Math.random()-0.5);}
function fillSelectors(){
    mainUnit.innerHTML=""; Object.keys(units).forEach(k=>mainUnit.innerHTML+=`<option>${k}</option>`); loadSub();
}
function loadSub(){
    subUnit.innerHTML=""; Object.keys(units[mainUnit.value]).forEach(k=>subUnit.innerHTML+=`<option>${k}</option>`);
}
mainUnit.onchange=loadSub;

function startGame(){ pool=shuffle([...units[mainUnit.value][subUnit.value]]); active=pool.splice(0,PAGE_SIZE); streak=0; render(); }
function startGeneralWrongs(){ pool=shuffle(Object.values(generalWrongs).map(o=>o.pair)); active=pool.splice(0,PAGE_SIZE); streak=0; render(); }

function render(){
    leftCol.innerHTML=""; rightCol.innerHTML="";
    active.forEach(p=>{
        const d=document.createElement("div");
        d.className="card"; d.innerText=p.left; d.onclick=()=>{selLeft=p; select(d);}; leftCol.appendChild(d);
    });
    shuffle([...active]).forEach(p=>{
        const d=document.createElement("div");
        d.className="card";
        d.dataset.rights = JSON.stringify(p.right);
        d.innerText = p.right[0];
        d.onclick = ()=>{selRight=p; select(d);};
        rightCol.appendChild(d);
    });
}

function select(el){
    document.querySelectorAll(".card").forEach(c=>c.classList.remove("selected"));
    el.classList.add("selected");
    if(selLeft && selRight) check();
}

function check(){
    const l = [...leftCol.children].find(c=>c.innerText===selLeft.left);
    const r = [...rightCol.children].find(c=>c.innerText===selRight.right);
    const rights = Array.isArray(selLeft.right)?selLeft.right:[selLeft.right];
    if(rights.includes(selRight.right)){
        streak++;
        playDing();
        l.classList.add("correct"); r.classList.add("correct");
        // tÃ¼m doÄŸru eÅŸleÅŸmeleri yeÅŸil yap
        rights.forEach(val=>{
            [...rightCol.children].filter(c=>c.innerText===val).forEach(c=>c.classList.add("correct"));
        });
        markCorrect(selLeft);
        setTimeout(()=>{
            active = active.filter(p=>p!==selLeft);
            if(pool.length) active.push(pool.shift());
            selLeft=selRight=null;
            render();
        },180);
    }else{
        streak=0;
        l.classList.add("wrong"); r.classList.add("wrong");
        playDong(); markWrong(selLeft);
        setTimeout(()=>{
            l.classList.remove("wrong"); r.classList.remove("wrong");
            selLeft=selRight=null;
        },300);
    }
}

fillSelectors();
</script>
</body>
</html>
